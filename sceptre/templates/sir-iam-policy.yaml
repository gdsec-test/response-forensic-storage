AWSTemplateFormatVersion: 2010-09-09
Description: IAM Custom Policy for use with the sir IAM User
Parameters:
  # Must be provided by region specific config if any based on requirement
  PolicyNameSuffix:
    Type: String
    Description: Name of custom Policy appended to TeamName-custom-
    Default: "SamplePolicyName"
  DevelopmentTeam:
    Type: AWS::SSM::Parameter::Value<String>
    Description: SSM Parameter for team owning the created resources.
    Default: /AdminParams/Team/Name
    AllowedValues:
      - /AdminParams/Team/Name
  DevelopmentEnvironment:
    Type: AWS::SSM::Parameter::Value<String>
    Description: SSM Parameter for development environment this will live in.
    Default: /AdminParams/Team/Environment
    AllowedValues:
      - /AdminParams/Team/Environment

Resources:
  IAMPolicy:
    Type: AWS::ServiceCatalog::CloudFormationProvisionedProduct
    Properties:
      ProductName: IAMPolicy
      ProvisioningArtifactName: 1.0.0
      ProvisionedProductName: sir-iam-policy
      ProvisioningParameters:
        - Key: PolicyNameSuffix
          Value: !Ref PolicyNameSuffix
        - Key: PolicyJSON
          Value: !Sub |
            {
              "Version": "2012-10-17",
              "Statement": [
                  {
                      "Sid": "VisualEditor0",
                      "Effect": "Allow",
                      "Action": [
                          "s3:GetObject",
                          "s3:ListBucket"
                      ],
                      "Resource": [
                          "arn:aws:s3:::gd-${DevelopmentTeam}-${DevelopmentEnvironment}-forensic-storage",
                          "arn:aws:s3:::gd-${DevelopmentTeam}-${DevelopmentEnvironment}-forensic-storage/*"
                      ]
                  },
                  {
                      "Sid": "VisualEditor1",
                      "Effect": "Allow",
                      "Action": [
                          "s3:ListAllMyBuckets",
                          "s3:GetBucketLocation"
                      ],
                      "Resource": "*"
                  }
              ]
            }
      Tags:
        - Key: doNotShutDown
          # change to false if it can be turned off outside of business hours
          Value: "true"
